<!doctype html>
<html lang="ja">
    <head>
        <title>第6回 C#でお絵描き - 東北大学プログラミング演習B (C#)</title>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="stylesheet" href="./css/cs.css">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz@20" rel="stylesheet">
<script type="text/javascript" src="./js/preprocess.js"></script>
    </head>
    <body>
        <header>
                      <nav>
              <ul>
                <li class="top"><a href="./">ホーム</a></li>
                <!-- <li><a href="./setup.html">環境構築1</a></li> -->
                <!-- <li><a href="./setup_gui.html">環境構築2</a></li> -->
                <li class="dd"><span class="ddt">環境構築</span>
                  <ul>
                    <li><a href="./setup.html">環境構築1（C#/F#共通）</a></li>
                    <li><a href="./setup_gui.html">環境構築2（C#演習用）</a></li>
                    <li><a href="./setup_q.html">確認用課題</a></li>
                  </ul>
                </li>
                <li class="dd"><span class="ddt">講義資料</span>
                  <ul> 
                    <li><a href="./w1.html">第1回資料</a><a href="./q1.html">第1回課題</a></li>
                    <li><a href="./w2.html">第2回資料</a><a href="./q2.html">第2回課題</a></li>
                    <li><a href="./w3.html">第3回資料</a><a href="./q3.html">第3回課題</a></li>
                    <li><a href="./w4.html">第4回資料</a><a href="./q4.html">第4回課題</a></li>
                    <li><a href="./w5.html">第5回資料</a><a href="./q5.html">第5回課題</a></li>
                    <li><a href="./w6.html">第6回資料</a><a href="./q6.html">第6回課題</a></li>
                  </ul>
                </li>
                <li><a href="./links.html">参考書など</a></li>
             </ul>
            </nav>

            
               <h1>第6回 C#でお絵描き</h1>
             
            
               <p class="last-update">最終更新: 2024-05-29 19:29:06</p> 
            
            <div class="qnav">
              <ul>
                <li><a href="w6.html">講義資料</a></li><li><a href="q6.html">課題</a></li>
              </ul>
            </div>   
        </header>

        <main role="main" class="with-right-nav">
            <nav class="toc">
<ul>
<li><a href="#drawableコントロール" id="toc-drawableコントロール"><code>Drawable</code>コントロール</a></li>
<li><a href="#フォント" id="toc-フォント">フォント</a></li>
<li><a href="#マウスイベントの処理クリックした位置に円を描く" id="toc-マウスイベントの処理クリックした位置に円を描く">マウスイベントの処理：クリックした位置に円を描く</a>
<ul>
<li><a href="#円の色を選択できるように" id="toc-円の色を選択できるように">円の色を選択できるように</a></li>
<li><a href="#複数個の円を描く" id="toc-複数個の円を描く">複数個の円を描く</a></li>
</ul></li>
</ul>
</nav>
<section class="mainbody"><section id="drawableコントロール" class="level2">
<h2><code>Drawable</code>コントロール</h2>
<p>Eto.Forms の <code>Drawable</code> コントロールを利用することで，直線，矩形，楕円，文字列等いろんなものをコントロールに自由に描画できる．</p>
<p>そのためには，以下のように<code>Drawable</code>の<code>Paint</code>イベントを購読（ハンドラを登録）するとよい．</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MainForm.cs </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Forms</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Drawing</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">// テンプレート作成時にプロジェクト名を DrawableDemo にしたことを想定（以後同様の説明を省略）</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">// このnamespaceは，「〜.Gtk」等にある Program.cs においても利用されるので変更するとそちら（3箇所）も変更する必要がある．</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> DrawableDemo</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> MainForm <span class="op">:</span> Form</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">MainForm</span><span class="op">()</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            Title <span class="op">=</span> <span class="st">&quot;Drawable Demo&quot;</span><span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            ClientSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">Size</span><span class="op">(</span><span class="dv">320</span><span class="op">,</span> <span class="dv">420</span><span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            Drawable drawable <span class="op">=</span> <span class="kw">new</span> <span class="fu">Drawable</span><span class="op">();</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Paintを購読</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">// (s,pe) =&gt; { ... } の部分はPaintイベントが発生したときに呼ばれる処理であることに注意する．</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="co">// この時点でコントロールの中身がその部分の通りに描画されるわけではない．</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            drawable<span class="op">.</span><span class="fu">Paint</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> pe<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                Graphics g <span class="op">=</span> pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>Size<span class="op">);</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>                g<span class="op">.</span><span class="fu">Clear</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">White</span><span class="op">);</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 50 px 幅の格子を描く</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x <span class="op">&lt;</span> <span class="kw">this</span><span class="op">.</span><span class="fu">Size</span><span class="op">.</span><span class="fu">Width</span><span class="op">;</span> x <span class="op">+=</span> <span class="dv">50</span><span class="op">)</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                    g<span class="op">.</span><span class="fu">DrawLine</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">LightGrey</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">Point</span><span class="op">(</span>x<span class="op">,</span> <span class="dv">0</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">Point</span><span class="op">(</span>x<span class="op">,</span> drawable<span class="op">.</span><span class="fu">Size</span><span class="op">.</span><span class="fu">Height</span><span class="op">));</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> y <span class="op">&lt;</span> <span class="kw">this</span><span class="op">.</span><span class="fu">Size</span><span class="op">.</span><span class="fu">Height</span><span class="op">;</span> y <span class="op">+=</span> <span class="dv">50</span><span class="op">)</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                    g<span class="op">.</span><span class="fu">DrawLine</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">LightGrey</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">Point</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> y<span class="op">),</span> <span class="kw">new</span> <span class="fu">Point</span><span class="op">(</span>drawable<span class="op">.</span><span class="fu">Size</span><span class="op">.</span><span class="fu">Width</span><span class="op">,</span> y<span class="op">));</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">300</span><span class="op">;</span> i <span class="op">+=</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// 指定のペン，始点，終点で線を描く</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                    g<span class="op">.</span><span class="fu">DrawLine</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Pen</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">Blue</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">Point</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">Point</span><span class="op">(</span>i<span class="op">,</span> <span class="dv">100</span><span class="op">));</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 矩形のアウトラインを描く</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>                g<span class="op">.</span><span class="fu">DrawRectangle</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">Red</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">300</span><span class="op">,</span> <span class="dv">50</span><span class="op">)));</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Colors.Red と書くかわりに Color.FromRgb(0xFF0000) で陽にRGBを指定できる</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>                g<span class="op">.</span><span class="fu">FillRectangle</span><span class="op">(</span>Color<span class="op">.</span><span class="fu">FromRgb</span><span class="op">(</span><span class="bn">0xFF0000</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">150</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">300</span><span class="op">,</span> <span class="dv">50</span><span class="op">)));</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 楕円のアウトラインを描く．Colors.Lime は Color.FromRgb(0x00FF00) と同じ色</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                g<span class="op">.</span><span class="fu">DrawEllipse</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Pen</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">Lime</span><span class="op">,</span> <span class="dv">2</span>F<span class="op">),</span> <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">200</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">300</span><span class="op">,</span> <span class="dv">50</span><span class="op">)));</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 内部が塗られた楕円を描く．Colors.Green は暗めの緑</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>                g<span class="op">.</span><span class="fu">FillEllipse</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">Green</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span><span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">250</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">300</span><span class="op">,</span> <span class="dv">50</span><span class="op">)));</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>                <span class="co">// システムのデフォルトフォント，サイズ 50pt</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                Font f <span class="op">=</span> <span class="kw">new</span> <span class="fu">Font</span><span class="op">(</span>SystemFont<span class="op">.</span><span class="fu">Default</span><span class="op">,</span> <span class="dv">50</span><span class="op">);</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>                <span class="co">// テキストを指定フォントで指定座標（左上点）に描く．</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                g<span class="op">.</span><span class="fu">DrawText</span><span class="op">(</span>f<span class="op">,</span> Color<span class="op">.</span><span class="fu">FromArgb</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="bn">0x80</span><span class="op">,</span> <span class="bn">0xff</span><span class="op">,</span> <span class="bn">0x80</span><span class="op">),</span> <span class="kw">new</span> <span class="fu">Point</span><span class="op">(</span><span class="dv">100</span><span class="op">,</span> <span class="dv">0</span><span class="op">),</span> <span class="st">&quot;文字列&quot;</span><span class="op">);</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>                <span class="co">// PointFやRectangleFのFはfloatのF．以下はどのように表示されるかな？</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>                <span class="co">// ディスプレイ（Retinaとか）によってはアンチエイリアスもかからない．</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>                    PointF start <span class="op">=</span> <span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">25</span>F <span class="op">+</span> <span class="fl">0.5F</span> <span class="op">*</span> i<span class="op">,</span> <span class="dv">300</span> <span class="op">+</span> <span class="dv">20</span> <span class="op">*</span> i<span class="op">);</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>                    PointF end <span class="op">=</span> start <span class="op">+</span> <span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">20</span><span class="op">);</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>                    g<span class="op">.</span><span class="fu">DrawLine</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Pen</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">Black</span><span class="op">,</span> <span class="dv">1</span>F<span class="op">),</span> start<span class="op">,</span> end<span class="op">);</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Mac環境のワークアラウンド．</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Drawableの最初のPaint時にSizeが値が正しくない https://github.com/picoe/Eto/issues/2104 </span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>            <span class="co">//</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Eto.Forms 2.6.1においては，GtkでもSizeがワンテンポ遅れて変化したりする（https://github.com/picoe/Eto/issues/1752）ので</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 現状ではSizeに依存するコードはかかないほうがよいかもしれない．</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>            <span class="co">//</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Invalidate()はコントロールに再描画を促す（結果，Paintイベントを発生させる）．</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>            drawable<span class="op">.</span><span class="fu">SizeChanged</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span> drawable<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>            Content <span class="op">=</span> drawable<span class="op">;</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>            Menu <span class="op">=</span> <span class="kw">new</span> <span class="fu">MenuBar</span><span class="op">();</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上記のMac（非Retinaディスプレイでの表示）での実行例（DPIの違いからWindowsだと「文字列」の部分の大きさが変わる）．</p>
<p><img src="images/eto/drawable_example.png" alt="image" /></p>
<p>上で使用した<code>Graphics</code>のメソッドとその関連メソッド．</p>
<table>
<tbody>
<tr class="odd">
<td><code>Clear(Color)</code></td>
<td>描画領域を指定された色でクリアする．</td>
</tr>
<tr class="even">
<td><code>DrawLine(Color,PointF,PointF)</code></td>
<td>指定された色で，与えられた始点から終点まで線を引く．なお，<code>Point</code>は<code>PointF</code>へ暗黙に型変換可能．</td>
</tr>
<tr class="odd">
<td><code>DrawLine(Pen,PointF,PointF)</code></td>
<td>指定されたペンで，与えられた始点から終点まで線を引く．<code>Pen</code>は色の他にたとえば太さの情報を持つ．</td>
</tr>
<tr class="even">
<td><code>DrawRectangle(Color, RectangleF)</code></td>
<td>指定された色で，与えられた矩形のアウトラインを描く．</td>
</tr>
<tr class="odd">
<td><code>DrawRectangle(Pen, RectangleF)</code></td>
<td>上のペン版．</td>
</tr>
<tr class="even">
<td><code>DrawEllipse(Color, RectangleF)</code></td>
<td>指定された色で，与えられた矩形に内接する楕円のアウトラインを描く．</td>
</tr>
<tr class="odd">
<td><code>DrawEllipse(Pen, RectangleF)</code></td>
<td>上のペン版．</td>
</tr>
<tr class="even">
<td><code>FillRectangle(Color, RectangleF)</code></td>
<td>指定された色で与えられた矩形の内部を塗る．</td>
</tr>
<tr class="odd">
<td><code>FillEllipse(Color, RectangleF)</code></td>
<td>指定された色で与えられた矩形に内接する楕円の内部を塗る．</td>
</tr>
<tr class="even">
<td><code>DrawText(Font,Color,PointF,string)</code></td>
<td>指定されたフォント，色，位置（左上）に与えられた文字列を描く．</td>
</tr>
</tbody>
</table>
<p>また，新たな型のコンストラクタ．</p>
<table>
<tbody>
<tr class="odd">
<td><code>RectangleF(PointF, SizeF)</code></td>
<td>指定された位置，サイズの<code>RectangleF</code>を作成するコンストラクタ．</td>
</tr>
<tr class="even">
<td><code>Point(int, int)</code></td>
<td>位置を表す型，<code>Point</code>のコンストラクタ．x/y座標にはプロパティ<code>X</code>と<code>Y</code>からアクセス可．</td>
</tr>
<tr class="odd">
<td><code>PointF(float, float)</code></td>
<td>上の<code>float</code>版．</td>
</tr>
<tr class="even">
<td><code>SizeF(float, float)</code></td>
<td><code>Size</code>の<code>float</code>版，<code>SizeF</code>のコンストラクタ．幅と高さにはプロパティ<code>Height</code>と<code>Width</code>からアクセス可．</td>
</tr>
<tr class="odd">
<td><code>Pen(Color, float)</code></td>
<td>指定された色と太さの<code>Pen</code>を作成するコンストラクタ．</td>
</tr>
<tr class="even">
<td><code>Font(SystemFont,float)</code></td>
<td>指定されたシステムフォント，サイズ (pt)の<code>Font</code>を作成するコンストラクタ．システムフォントには <code>SystemFont.Default</code>のほか，<code>SystemFont.Bold</code>や <code>SystemFont.TitleBar</code> などがある．</td>
</tr>
</tbody>
</table>
<p>そして，色を操作するのに用いた以下のstaticメソッドやフィールド．</p>
<table>
<tbody>
<tr class="odd">
<td><code>Color.FromRgb(int)</code></td>
<td><code>0xFF0000</code>（赤）などのような整数から色を作成．</td>
</tr>
<tr class="even">
<td><code>Color.FromArgb(int)</code></td>
<td><code>0xFFFF0000</code>（不透明な赤）などのような整数から色を作成．</td>
</tr>
<tr class="odd">
<td><code>Color.FromArgb(int,int,int,int)</code></td>
<td>R, G, B, Aのそれぞれの要素（0-255）から色を作成（メソッドの名前に反して順番はRGBAなのに注意）．Aは255が不透明．0は透明．</td>
</tr>
<tr class="even">
<td><code>Colors.Blue</code>など</td>
<td>規定の色を表す定数．</td>
</tr>
</tbody>
</table>
<p>なお，上記はあくまで一部である．より詳細は<a href="http://pages.picoe.ca/docs/api/html/T_Eto_Drawing_Graphics.htm">Eto.FormsのドキュメンテーションのGraphicsのページ</a>を見るとよい．</p>
</section>
<section id="フォント" class="level2">
<h2>フォント</h2>
<p><code>Font(FontFamily,float)</code>コンストラクタを使うことで，システムにインストールされたフォントから<code>Font</code>オブジェクトを作成できる．</p>
<p><code>FontFamily</code>インスタンスの作成にはフォント名をとるコンストラクタ<code>FontFamily(string)</code>を用いてもよいが，システムによってインストールされているフォントは違うので<code>Fonts.AvailableFontFamilies</code>を使うのがよいかもしれない．たとえば，<code>Fonts.AvailableFontFamilies</code>は以下のように<code>List&lt;FontFamily&gt;</code>に変換することができる．</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// システムにインストールされているフォントを取得し，List&lt;FontFamily&gt;に変換する</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>List<span class="op">&lt;</span>FontFamily<span class="op">&gt;</span> fontfamilies <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>T<span class="op">&gt;(</span> Font<span class="op">.</span><span class="fu">AvailableFontFamilies</span> <span class="op">);</span> </span></code></pre></div>
<p>折角なので，いままで紹介していないコントロールを使って，フォントファミリとサイズを指定して，文字列を描画するプログラムを作ってみよう．具体的には <code>DropDown</code> と <code>NumericStepper</code> を使用する．</p>
<p>以下のようにすることで，<code>Fonts.AvailableFontFamilies</code>が中身となるようなドロップダウンを作成できる．</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>DropDown fontfamilyChooser <span class="op">=</span> <span class="kw">new</span> <span class="fu">DropDown</span><span class="op">();</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">// ドロップダウンの「中身」を Fonts.AvailableFontFamilies にセットする</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>fontfamilyChooser<span class="op">.</span><span class="fu">DataStore</span> <span class="op">=</span> Fonts<span class="op">.</span><span class="fu">AvailableFontFamilies</span><span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ドロップダウンの要素をどのようにして表示するための文字列にするかを規定する（詳細は説明しない）</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>fontfamilyChooser<span class="op">.</span><span class="fu">ItemTextBinding</span> <span class="op">=</span> Binding<span class="op">.</span><span class="fu">Delegate</span><span class="op">((</span><span class="dt">object</span> o<span class="op">)</span> <span class="op">=&gt;</span> o<span class="op">.</span><span class="fu">ToString</span><span class="op">());</span>   </span></code></pre></div>
<p>フォントのサイズの選択には<code>NumericStepper</code>を使うことにする．これは，数値を選択するためのコントロールであり，数字の横に上三角形と下三角形が表示されている．きっとよく見るようなものであると思われる．注意事項としては選択される数等は<code>double</code>型であるという点である．</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>NumericStepper sizeSelector <span class="op">=</span> <span class="kw">new</span> NumericStepper</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    MinValue <span class="op">=</span> <span class="dv">5</span><span class="op">,</span>   <span class="co">// 最小値</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    MaxValue <span class="op">=</span> <span class="dv">150</span><span class="op">,</span> <span class="co">// 最大値</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    Increment <span class="op">=</span> <span class="dv">1</span><span class="op">,</span>  <span class="co">// 増分</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    Value <span class="op">=</span> <span class="dv">25</span>      <span class="co">// 今の値</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>また，描画するテキストもユーザが入力できるようにする．これはこれまでも出てきた<code>TextBox</code>を使う．</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>TextBox textToDraw <span class="op">=</span> <span class="kw">new</span> TextBox <span class="op">{</span> PlaceholderText <span class="op">=</span> <span class="st">&quot;Text to Draw&quot;</span> <span class="op">};</span></span></code></pre></div>
<p>そして，テキストを描画するための<code>Drawable</code>を準備する．</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Drawable d <span class="op">=</span> <span class="kw">new</span> <span class="fu">Drawable</span><span class="op">();</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>d<span class="op">.</span><span class="fu">Paint</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> pe<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">.</span><span class="fu">Clear</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">White</span><span class="op">);</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// fontfamilyChooser.SelectedValue は FontFamily のインスタンスであるはずなのでキャストする．</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// なにも選ばれていない状態だと fontfamilyChooser.SelectedValue は null だが，その場合は FontFamily 型の null となる．</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    FontFamily ff <span class="op">=</span> <span class="op">(</span>FontFamily<span class="op">)</span> fontfamilyChooser<span class="op">.</span><span class="fu">SelectedValue</span><span class="op">;</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>ff <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// sizerSelector.Value は double なので int に丸める．</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 注：Fontコンストラクタの第2引数はfloatなので，floatにキャストしたのでも十分ではある．</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">.</span><span class="fu">DrawText</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Font</span><span class="op">(</span>ff<span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>sizeSelector<span class="op">.</span><span class="fu">Value</span><span class="op">),</span> Colors<span class="op">.</span><span class="fu">Black</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">),</span> textToDraw<span class="op">.</span><span class="fu">Text</span><span class="op">);</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>最後に<code>fontfamilyChooser</code>，<code>sizeSelector</code>，<code>textToDraw</code>の内容に変更があったときに，<code>d</code>を再描画するようにする．そうでなければ，リサイズ等の他に更新すべき理由がない限り描画領域は更新されない．</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Invalidate() はコントロールに再描画を促す</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">// これらをコメントアウトしてみるとどのような挙動になるだろうか？</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>fontfamilyChooser<span class="op">.</span><span class="fu">SelectedIndexChanged</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sizeSelector<span class="op">.</span><span class="fu">ValueChanged</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>textToDraw<span class="op">.</span><span class="fu">TextChanged</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span></code></pre></div>
<p>あとは適当にこれらのコンポーネントは配置すればよい．まとめると<code>MainForm.cs</code>への変更は以下のようになる．</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MainForm.cs</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Forms</span><span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Drawing</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> FontDemo</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> MainForm <span class="op">:</span> Form</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">MainForm</span><span class="op">()</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            Title <span class="op">=</span> <span class="st">&quot;Font Demo&quot;</span><span class="op">;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            MinimumSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">Size</span><span class="op">(</span><span class="dv">200</span><span class="op">,</span> <span class="dv">200</span><span class="op">);</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            DropDown fontfamilyChooser <span class="op">=</span> <span class="kw">new</span> DropDown <span class="op">{</span> <span class="op">};</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            fontfamilyChooser<span class="op">.</span><span class="fu">DataStore</span> <span class="op">=</span> Fonts<span class="op">.</span><span class="fu">AvailableFontFamilies</span><span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            fontfamilyChooser<span class="op">.</span><span class="fu">ItemTextBinding</span> <span class="op">=</span> Binding<span class="op">.</span><span class="fu">Delegate</span><span class="op">((</span><span class="dt">object</span> o<span class="op">)</span> <span class="op">=&gt;</span> o<span class="op">.</span><span class="fu">ToString</span><span class="op">());</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            NumericStepper sizeSelector <span class="op">=</span> <span class="kw">new</span> NumericStepper</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                MinValue <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                MaxValue <span class="op">=</span> <span class="dv">150</span><span class="op">,</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                Increment <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                Value <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>            TextBox textToDraw <span class="op">=</span> <span class="kw">new</span> TextBox <span class="op">{</span> PlaceholderText <span class="op">=</span> <span class="st">&quot;Text to Draw&quot;</span> <span class="op">};</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            Drawable d <span class="op">=</span> <span class="kw">new</span> <span class="fu">Drawable</span><span class="op">();</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="fu">Paint</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> pe<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">.</span><span class="fu">Clear</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">White</span><span class="op">);</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                FontFamily ff <span class="op">=</span> <span class="op">(</span>FontFamily<span class="op">)</span>fontfamilyChooser<span class="op">.</span><span class="fu">SelectedValue</span><span class="op">;</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>ff <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                    pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">.</span><span class="fu">DrawText</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Font</span><span class="op">(</span>ff<span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>sizeSelector<span class="op">.</span><span class="fu">Value</span><span class="op">),</span> Colors<span class="op">.</span><span class="fu">Black</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">),</span> textToDraw<span class="op">.</span><span class="fu">Text</span><span class="op">);</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>            fontfamilyChooser<span class="op">.</span><span class="fu">SelectedIndexChanged</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>            sizeSelector<span class="op">.</span><span class="fu">ValueChanged</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>            textToDraw<span class="op">.</span><span class="fu">TextChanged</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span> d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>            Content <span class="op">=</span> <span class="kw">new</span> StackLayout</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>                Padding <span class="op">=</span> <span class="dv">10</span><span class="op">,</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>                Spacing <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>                HorizontalContentAlignment <span class="op">=</span> HorizontalAlignment<span class="op">.</span><span class="fu">Stretch</span><span class="op">,</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                Items <span class="op">=</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">new</span> StackLayout</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>                        Orientation <span class="op">=</span> Orientation<span class="op">.</span><span class="fu">Horizontal</span><span class="op">,</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>                        Items <span class="op">=</span> <span class="op">{</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>                            fontfamilyChooser<span class="op">,</span> sizeSelector</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>                    <span class="op">},</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>                    textToDraw<span class="op">,</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">new</span> <span class="fu">StackLayoutItem</span> <span class="op">(</span>d<span class="op">,</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>            Menu <span class="op">=</span> <span class="kw">new</span> <span class="fu">MenuBar</span><span class="op">();</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上記のMac（非Retinaディスプレイでの表示）での実行例は以下となる（起動直後ではなく，リサイズやテキストの変更などを行った状態）．</p>
<p><img src="./images/eto/font_demo.png" alt="image" /></p>
</section>
<section id="マウスイベントの処理クリックした位置に円を描く" class="level2">
<h2>マウスイベントの処理：クリックした位置に円を描く</h2>
<p>マウスイベントを購読するには，<code>MouseDown</code>等にハンドラを登録すればよい．</p>
<table>
<thead>
<tr class="header">
<th>イベント</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>MouseDown</code></td>
<td>マウスボタンの押下．</td>
</tr>
<tr class="even">
<td><code>MouseUp</code></td>
<td>マウスボタンを押したのを離す．クリックを取りたいなら，これか上のを使う（実際のアプリケーションでも，押下時に反応するボタンと，離したときに反応するボタンがあるようである）．</td>
</tr>
<tr class="odd">
<td><code>MouseEnter</code></td>
<td>マウスポインタがそのコントロールの領域に入る．</td>
</tr>
<tr class="even">
<td><code>MouseLeave</code></td>
<td>マウスポインタがそのコントロールの領域から出る．</td>
</tr>
<tr class="odd">
<td><code>MouseWheel</code></td>
<td>ホイールを回す．縦とは限らない．</td>
</tr>
<tr class="even">
<td><code>MouseMove</code></td>
<td>マウスポインタがそのコントロールの領域内で動く．</td>
</tr>
<tr class="odd">
<td><code>MouseDoubleClick</code></td>
<td>ダブルクリック．</td>
</tr>
</tbody>
</table>
<p>これらに渡すハンドラの第2引数は<code>MouseEventArgs</code>になる．たとえば以下のプロパティを通じて，イベント発生時のマウスの状態を取得できる．</p>
<table>
<tbody>
<tr class="odd">
<td><code>Buttons</code></td>
<td>マウスのボタン（<code>Buttons.Primary</code>や<code>Buttons.Alternate</code>など．同時押しもOK）</td>
</tr>
<tr class="even">
<td><code>Delta</code></td>
<td><code>SizeF</code>型．ホイールの増分</td>
</tr>
<tr class="odd">
<td><code>Location</code></td>
<td><code>PointF</code>型．ポインタの位置．</td>
</tr>
<tr class="even">
<td><code>Modifiers</code></td>
<td>修飾キー．（<code>Keys.Control</code>や<code>Keys.Alt</code>など）</td>
</tr>
</tbody>
</table>
<p>なお，押されたボタンがどれかは<code>HasFlag</code>を使えばよい．たとえば，以下のように．</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>MouseUp <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> me<span class="op">)</span> <span class="op">=&gt;</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>   <span class="kw">if</span> <span class="op">(</span> me<span class="op">.</span><span class="fu">Buttons</span><span class="op">.</span><span class="fu">HasFlag</span><span class="op">(</span>Buttons<span class="op">.</span><span class="fu">Primary</span><span class="op">)</span> <span class="op">)</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>       <span class="co">// 左クリック（左利き用設定をしていない場合）のときの処理</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span> me<span class="op">.</span><span class="fu">Buttons</span><span class="op">.</span><span class="fu">HasFlag</span><span class="op">(</span>Buttons<span class="op">.</span><span class="fu">Alternate</span><span class="op">)</span> <span class="op">)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>   <span class="op">{</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>       <span class="co">// 右クリックのときの処理</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>では，マウスイベントのハンドリングの例として，マウスのクリック位置に円を描くプログラムを作ってみよう．<code>Drawable</code>もコントロールなので，その<code>MouseDown</code>イベントを購読すればよい．たとえば，以下のように．</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MainForm.cs</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Forms</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Drawing</span><span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> MouseDemo</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> MainForm <span class="op">:</span> Form</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">MainForm</span><span class="op">()</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            Title <span class="op">=</span> <span class="st">&quot;Mouse Demo&quot;</span><span class="op">;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>            MinimumSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">Size</span><span class="op">(</span><span class="dv">200</span><span class="op">,</span> <span class="dv">200</span><span class="op">);</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            PointF clicked <span class="op">=</span> <span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            SizeF circleSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>            Drawable d <span class="op">=</span> <span class="kw">new</span> <span class="fu">Drawable</span><span class="op">();</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="fu">Paint</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> pe<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 演算子のオーバローディングにより，floatをSizeFに掛けることもできるし，PointFにSizeFを加減算可能．</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">.</span><span class="fu">FillEllipse</span><span class="op">(</span>Colors<span class="op">.</span><span class="fu">Black</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span>clicked <span class="op">-</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">,</span> clicked <span class="op">+</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">));</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="fu">MouseDown</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> me<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                clicked <span class="op">=</span> me<span class="op">.</span><span class="fu">Location</span><span class="op">;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>            Content <span class="op">=</span> d<span class="op">;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            Menu <span class="op">=</span> <span class="kw">new</span> <span class="fu">MenuBar</span><span class="op">();</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>たとえばMacにおける，上（を含むプログラム）の実行例は以下となる．</p>
<p><img src="./images/eto/mouse_demo.png" alt="image" /></p>
<section id="円の色を選択できるように" class="level3">
<h3>円の色を選択できるように</h3>
<p>作成したプログラムを少し拡張して，色を選べるようにしてみよう．この目的には<code>ColorPicker</code>というコントロールが利用可能である．このコントロールはクリックすると専用のダイアログ（プラットフォーム毎に異なる）を表示し，ユーザが色を選ぶことを可能にする．</p>
<p>より具体的には，<code>ColorPicker</code>により<em>次にクリックしたとき</em>に表示される円の色を指定できるようする．そのためには，中心の座標のみならず，塗るべき色も覚えておけばよい．そのために，以下のクラスを準備する．</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 色と中心点の組</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ColoredCircle</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 中心点</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> PointF Center <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 色</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Color Color <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">ColoredCircle</span><span class="op">(</span>PointF center<span class="op">,</span> Color col<span class="op">)</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        Center <span class="op">=</span> center<span class="op">;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        Color <span class="op">=</span> col<span class="op">;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 描画法</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">Draw</span><span class="op">(</span>Graphics g<span class="op">)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        SizeF circleSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span> <span class="co">// サイズは今のところ決め打ち</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        g<span class="op">.</span><span class="fu">FillEllipse</span><span class="op">(</span>Color<span class="op">,</span> <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span>Center <span class="op">-</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">,</span> Center <span class="op">+</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">));</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><code>PointF</code>型の<code>clicked</code>の代わりに，<code>ColoredCircle</code>型の変数を用意し，<code>Drawable</code>の<code>Paint</code>イベントのハンドラは，その変数がnullでなければ，指しているインスタンスの<code>Draw</code>を呼ぶようにする．</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ColoredCircle cc <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Drawable d <span class="op">=</span> <span class="kw">new</span> <span class="fu">Drawable</span><span class="op">();</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>d<span class="op">.</span><span class="fu">Paint</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> pe<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>cc <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span> cc<span class="op">.</span><span class="fu">Draw</span><span class="op">(</span>pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">);</span> <span class="op">}</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p><code>ColorPicker</code>の作成はとても簡単である．たとえば，初期カラーが赤であるようなカラーピッカーは以下のようにして作成できる．</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ColorPicker colorPicker <span class="op">=</span> <span class="kw">new</span> ColorPicker <span class="op">{</span> Value <span class="op">=</span> Colors<span class="op">.</span><span class="fu">Red</span> <span class="op">};</span></span></code></pre></div>
<p>あとは，描画領域がクリックされたときに，クリックされた座標とカラーピッカーの色から<code>ColoredCircle</code>を生成するようにすればよい．</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>d<span class="op">.</span><span class="fu">MouseDown</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> me<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    cc <span class="op">=</span> <span class="kw">new</span> <span class="fu">ColoredCircle</span><span class="op">(</span>me<span class="op">.</span><span class="fu">Location</span><span class="op">,</span> colorPicker<span class="op">.</span><span class="fu">Value</span><span class="op">);</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>全体ではコード（<code>MainForm.cs</code>の部分のみ）は以下となる．</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MainForm.cs</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Forms</span><span class="op">;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Drawing</span><span class="op">;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> MouseDemo2 </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ColoredCircle</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> PointF Center <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> Color Color <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">ColoredCircle</span><span class="op">(</span>PointF center<span class="op">,</span> Color col<span class="op">)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>            Center <span class="op">=</span> center<span class="op">;</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            Color <span class="op">=</span> col<span class="op">;</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">Draw</span><span class="op">(</span>Graphics g<span class="op">)</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>            SizeF circleSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>            g<span class="op">.</span><span class="fu">FillEllipse</span><span class="op">(</span>Color<span class="op">,</span> </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                          <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span>Center <span class="op">-</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">,</span> Center <span class="op">+</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">));</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> MainForm <span class="op">:</span> Form</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">MainForm</span><span class="op">()</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>            Title <span class="op">=</span> <span class="st">&quot;Mouse Demo 2&quot;</span><span class="op">;</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>            MinimumSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">Size</span><span class="op">(</span><span class="dv">200</span><span class="op">,</span> <span class="dv">200</span><span class="op">);</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>            ColoredCircle cc <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>            Drawable d <span class="op">=</span> <span class="kw">new</span> <span class="fu">Drawable</span><span class="op">();</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="fu">Paint</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> pe<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>cc <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span> <span class="op">{</span> cc<span class="op">.</span><span class="fu">Draw</span><span class="op">(</span>pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">);</span> <span class="op">}</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>            ColorPicker colorPicker <span class="op">=</span> <span class="kw">new</span> ColorPicker <span class="op">{</span> Value <span class="op">=</span> Colors<span class="op">.</span><span class="fu">Red</span> <span class="op">};</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="fu">MouseDown</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> me<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>                cc <span class="op">=</span> <span class="kw">new</span> <span class="fu">ColoredCircle</span><span class="op">(</span>me<span class="op">.</span><span class="fu">Location</span><span class="op">,</span> colorPicker<span class="op">.</span><span class="fu">Value</span><span class="op">);</span></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>            Content <span class="op">=</span> <span class="kw">new</span> StackLayout</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>                Padding <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>                Spacing <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>                HorizontalContentAlignment <span class="op">=</span> HorizontalAlignment<span class="op">.</span><span class="fu">Stretch</span><span class="op">,</span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>                Items <span class="op">=</span> <span class="op">{</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>                    colorPicker<span class="op">,</span></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">new</span> <span class="fu">StackLayoutItem</span><span class="op">(</span> d<span class="op">,</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>            Menu <span class="op">=</span> <span class="kw">new</span> <span class="fu">MenuBar</span><span class="op">();</span></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上のコードのMacでの実行例たとえば以下となる．</p>
<p><img src="./images/eto/mouse_demo2.png" alt="image" /></p>
</section>
<section id="複数個の円を描く" class="level3">
<h3>複数個の円を描く</h3>
<p>さて，円が一個だけでは寂しいのでもっとたくさん描画できるようしたい．そこで，クリックするたびに円を描くようにしたい．この実現方法は2通りある．</p>
<ul>
<li><code>ColoredCircle</code>のリストを覚えておき，<code>Paint</code>イベントのハンドラはそれらすべてを描画する．</li>
<li>画像を保持しておきクリックをしたら<code>ColoredCircle</code>をそこに描く．<code>Paint</code>イベントのハンドラは画像を表示する．</li>
</ul>
<section id="円のリストを覚える方法" class="level4">
<h4>円のリストを覚える方法</h4>
<p>前者の拡張はとても直截である．一つの<code>ColoredCircle</code>でなく，<code>ColoredCircle</code>のリストを保持するようにすればよい．上のコードに対する変更はわずか5箇所（うち一つはnamespaceの名前）だ．</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MainForm.cs</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span> <span class="co">// 追加</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Forms</span><span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Drawing</span><span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> MouseDemo3 <span class="co">// 変更箇所</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> ColoredCircle</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> PointF Center <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> Color Color <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">ColoredCircle</span><span class="op">(</span>PointF center<span class="op">,</span> Color col<span class="op">)</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            Center <span class="op">=</span> center<span class="op">;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            Color <span class="op">=</span> col<span class="op">;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">Draw</span><span class="op">(</span>Graphics g<span class="op">)</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>            SizeF circleSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>            g<span class="op">.</span><span class="fu">FillEllipse</span><span class="op">(</span>Color<span class="op">,</span> <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span>Center <span class="op">-</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">,</span> Center <span class="op">+</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">));</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> MainForm <span class="op">:</span> Form</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">MainForm</span><span class="op">()</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>            Title <span class="op">=</span> <span class="st">&quot;Mouse Demo 3&quot;</span><span class="op">;</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>            MinimumSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">Size</span><span class="op">(</span><span class="dv">200</span><span class="op">,</span> <span class="dv">200</span><span class="op">);</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>            List<span class="op">&lt;</span>ColoredCircle<span class="op">&gt;</span> ccs <span class="op">=</span> <span class="kw">new</span> List<span class="op">&lt;</span>ColoredCircle<span class="op">&gt;();</span> <span class="co">// 変更箇所</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>            Drawable d <span class="op">=</span> <span class="kw">new</span> <span class="fu">Drawable</span><span class="op">();</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="fu">Paint</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> pe<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>                <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> cc <span class="kw">in</span> ccs<span class="op">)</span> <span class="op">{</span> cc<span class="op">.</span><span class="fu">Draw</span><span class="op">(</span>pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">);</span> <span class="op">}</span> <span class="co">// 変更箇所</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>            ColorPicker colorPicker <span class="op">=</span> <span class="kw">new</span> ColorPicker <span class="op">{</span> Value <span class="op">=</span> Colors<span class="op">.</span><span class="fu">Red</span> <span class="op">};</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="fu">MouseDown</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> me<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>                ccs<span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ColoredCircle</span><span class="op">(</span>me<span class="op">.</span><span class="fu">Location</span><span class="op">,</span> colorPicker<span class="op">.</span><span class="fu">Value</span><span class="op">));</span> <span class="co">// 変更箇所</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>            Content <span class="op">=</span> <span class="kw">new</span> StackLayout</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>                Padding <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>                Spacing <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>                HorizontalContentAlignment <span class="op">=</span> HorizontalAlignment<span class="op">.</span><span class="fu">Stretch</span><span class="op">,</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>                Items <span class="op">=</span> <span class="op">{</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>                    colorPicker<span class="op">,</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">new</span> <span class="fu">StackLayoutItem</span><span class="op">(</span> d<span class="op">,</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>            Menu <span class="op">=</span> <span class="kw">new</span> <span class="fu">MenuBar</span><span class="op">();</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上のコードのMacにおける実行例は以下となる．</p>
<p><img src="./images/eto/mouse_demo3.png" alt="image" /></p>
</section>
<section id="画像を保持する方法" class="level4">
<h4>画像を保持する方法</h4>
<p>ビットマップイメージ（<code>Bitmap</code>）を保持し，マウスクリック時にはイメージのほうに円を描き，<code>Drawable</code>の<code>Paint</code>ではその画像を単に表示するという方法もある．その場合は，少しプログラムが複雑になるので，<code>Drawable</code>に関連するイベント処理を，派生クラスのコンストラクタにまとめてしまうのがよいだろう．</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MainForm.cs</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Forms</span><span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Eto<span class="op">.</span><span class="fu">Drawing</span><span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> MouseDemo4</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> DrawableImage <span class="op">:</span> Drawable</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> Bitmap bitmap<span class="op">;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> Color CurrentColor <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">DrawableImage</span><span class="op">()</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 200x200のビットマップを作成．透明度付き</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">// PixelFormat.Format32bppRgba は1画素が32ビット（4バイト）で表されていて，</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 上位から順に アルファ，赤，緑，青 がそれぞれ8ビット（1バイト）ずつ並んでいることを表す．</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>            bitmap <span class="op">=</span> <span class="kw">new</span> <span class="fu">Bitmap</span><span class="op">(</span><span class="dv">200</span><span class="op">,</span> <span class="dv">200</span><span class="op">,</span> PixelFormat<span class="op">.</span><span class="fu">Format32bppRgba</span><span class="op">);</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>            Paint <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> pe<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                <span class="co">// bitmap を描画するだけ</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                pe<span class="op">.</span><span class="fu">Graphics</span><span class="op">.</span><span class="fu">DrawImage</span><span class="op">(</span>bitmap<span class="op">,</span> <span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>            MouseDown <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> me<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>                SizeF circleSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">SizeF</span><span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>                PointF center <span class="op">=</span> me<span class="op">.</span><span class="fu">Location</span><span class="op">;</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>                <span class="co">// ビットマップに円を描画する．</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>                <span class="kw">using</span> <span class="op">(</span>Graphics g <span class="op">=</span> <span class="kw">new</span> <span class="fu">Graphics</span><span class="op">(</span>bitmap<span class="op">))</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>                    g<span class="op">.</span><span class="fu">FillEllipse</span><span class="op">(</span>CurrentColor<span class="op">,</span> <span class="kw">new</span> <span class="fu">RectangleF</span><span class="op">(</span>center <span class="op">-</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">,</span> center <span class="op">+</span> <span class="fl">0.5F</span> <span class="op">*</span> circleSize<span class="op">));</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>                <span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>            SizeChanged <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                <span class="co">// リサイズ時に適当にビットマップイメージのサイズを拡大する． </span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>bitmap<span class="op">.</span><span class="fu">Height</span> <span class="op">&lt;</span> ClientSize<span class="op">.</span><span class="fu">Height</span> <span class="op">||</span> bitmap<span class="op">.</span><span class="fu">Width</span> <span class="op">&lt;</span> ClientSize<span class="op">.</span><span class="fu">Width</span><span class="op">)</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>                    Bitmap oldImg <span class="op">=</span> bitmap<span class="op">;</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// 毎回毎回リサイズで描画領域が増えるごとにコピーするのはコストが大きいので，50%分の余裕をもたせる．</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// </span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>                    Size newSize <span class="op">=</span> Size<span class="op">.</span><span class="fu">Max</span><span class="op">(</span>ClientSize<span class="op">,</span> oldImg<span class="op">.</span><span class="fu">Size</span><span class="op">);</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>                    newSize <span class="op">+=</span> Size<span class="op">.</span><span class="fu">Max</span><span class="op">(</span>newSize <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">new</span> <span class="fu">Size</span><span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>                    Bitmap newImg <span class="op">=</span> <span class="kw">new</span> <span class="fu">Bitmap</span><span class="op">(</span>newSize<span class="op">,</span> PixelFormat<span class="op">.</span><span class="fu">Format32bppRgba</span><span class="op">);</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">using</span> <span class="op">(</span>Graphics g <span class="op">=</span> <span class="kw">new</span> <span class="fu">Graphics</span><span class="op">(</span>newImg<span class="op">))</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// 古いイメージをコピー</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>                        g<span class="op">.</span><span class="fu">DrawImage</span><span class="op">(</span>oldImg<span class="op">,</span> <span class="kw">new</span> <span class="fu">PointF</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>                    bitmap <span class="op">=</span> newImg<span class="op">;</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>                    oldImg<span class="op">.</span><span class="fu">Dispose</span><span class="op">();</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">Invalidate</span><span class="op">();</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">class</span> MainForm <span class="op">:</span> Form</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">MainForm</span><span class="op">()</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>            Title <span class="op">=</span> <span class="st">&quot;Mouse Demo 4&quot;</span><span class="op">;</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>            MinimumSize <span class="op">=</span> <span class="kw">new</span> <span class="fu">Size</span><span class="op">(</span><span class="dv">200</span><span class="op">,</span> <span class="dv">200</span><span class="op">);</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>            ColorPicker colorPicker <span class="op">=</span> <span class="kw">new</span> ColorPicker <span class="op">{</span> Value <span class="op">=</span> Colors<span class="op">.</span><span class="fu">Red</span> <span class="op">};</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>            DrawableImage d <span class="op">=</span> <span class="kw">new</span> DrawableImage <span class="op">{</span> CurrentColor <span class="op">=</span> colorPicker<span class="op">.</span><span class="fu">Value</span> <span class="op">};</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>            colorPicker<span class="op">.</span><span class="fu">ValueChanged</span> <span class="op">+=</span> <span class="op">(</span>s<span class="op">,</span> e<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>                d<span class="op">.</span><span class="fu">CurrentColor</span> <span class="op">=</span> colorPicker<span class="op">.</span><span class="fu">Value</span><span class="op">;</span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>            Content <span class="op">=</span> <span class="kw">new</span> StackLayout</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>                Padding <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>                Spacing <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>                HorizontalContentAlignment <span class="op">=</span> HorizontalAlignment<span class="op">.</span><span class="fu">Stretch</span><span class="op">,</span></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>                Items <span class="op">=</span> <span class="op">{</span></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>                    colorPicker<span class="op">,</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">new</span> <span class="fu">StackLayoutItem</span><span class="op">(</span> d<span class="op">,</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>            Menu <span class="op">=</span> <span class="kw">new</span> <span class="fu">MenuBar</span><span class="op">();</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>実行例は上と変わらないので割愛．</p>
</section>
</section>
</section></section>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
