<!doctype html>
<html lang="ja">
    <head>
        <title>第4回 ファイル入出力と例外処理 - 東北大学プログラミング演習B (C#)</title>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="stylesheet" href="./css/cs.css">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz@20" rel="stylesheet">
<script type="text/javascript" src="./js/preprocess.js"></script>
    </head>
    <body>
        <header>
                      <nav>
              <ul>
                <li class="top"><a href="./">ホーム</a></li>
                <!-- <li><a href="./setup.html">環境構築1</a></li> -->
                <!-- <li><a href="./setup_gui.html">環境構築2</a></li> -->
                <li class="dd"><span class="ddt">環境構築</span>
                  <ul>
                    <li><a href="./setup.html">環境構築1（C#/F#共通）</a></li>
                    <li><a href="./setup_gui.html">環境構築2（C#演習用）</a></li>
                    <li><a href="./setup_q.html">確認用課題</a></li>
                  </ul>
                </li>
                <li class="dd"><span class="ddt">講義資料</span>
                  <ul> 
                    <li><a href="./w1.html">第1回資料</a><a href="./q1.html">第1回課題</a></li>
                    <li><a href="./w2.html">第2回資料</a><a href="./q2.html">第2回課題</a></li>
                    <li><a href="./w3.html">第3回資料</a><a href="./q3.html">第3回課題</a></li>
                    <li><a href="./w4.html">第4回資料</a><a href="./q4.html">第4回課題</a></li>
                    <li><a href="./w5.html">第5回資料</a><a href="./q5.html">第5回課題</a></li>
                    <li><a href="./w6.html">第6回資料</a><a href="./q6.html">第6回課題</a></li>
                  </ul>
                </li>
                <li><a href="./links.html">参考書など</a></li>
             </ul>
            </nav>

            
               <h1>第4回 ファイル入出力と例外処理</h1>
             
            
               <p class="last-update">最終更新: 2025-05-20 10:55:39</p> 
            
            <div class="qnav">
              <ul>
                <li><a href="w4.html">講義資料</a></li><li><a href="q4.html">課題</a></li>
              </ul>
            </div>   
        </header>

        <main role="main" class="with-right-nav">
            <nav class="toc">
<ul>
<li><a href="#前回コレクションジェネリクスの続き" id="toc-前回コレクションジェネリクスの続き">前回（コレクション・ジェネリクス）の続き</a>
<ul>
<li><a href="#ディクショナリ連想配列" id="toc-ディクショナリ連想配列">ディクショナリ（連想配列）</a></li>
</ul></li>
<li><a href="#オブジェクト初期化子object-initializer" id="toc-オブジェクト初期化子object-initializer">オブジェクト初期化子（object initializer）</a></li>
<li><a href="#例外とその捕捉" id="toc-例外とその捕捉">例外とその捕捉</a></li>
<li><a href="#ファイル入出力" id="toc-ファイル入出力">ファイル入出力</a>
<ul>
<li><a href="#ファイルからの入力" id="toc-ファイルからの入力">ファイルからの入力</a></li>
<li><a href="#using文" id="toc-using文">using文</a></li>
<li><a href="#ファイルへの出力" id="toc-ファイルへの出力">ファイルへの出力</a></li>
</ul></li>
<li><a href="#いくつかの文字列操作関数" id="toc-いくつかの文字列操作関数">いくつかの文字列操作関数</a></li>
</ul>
</nav>
<section class="mainbody"><section id="前回コレクションジェネリクスの続き" class="level2">
<h2>前回（コレクション・ジェネリクス）の続き</h2>
<section id="ディクショナリ連想配列" class="level3">
<h3>ディクショナリ（連想配列）</h3>
<p><strong>ディクショナリ（連想配列などとも言われる）</strong>は配列やリストの一つの一般化であり，添字に一般のデータを許す．.NETにおいても，ディクショナリは<code>System.Collections.Generic.Dictionary&lt;TKey,TValue&gt;</code>として提供されている．</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DictionaryExample</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">()</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// キーの型がstringでバリューの型がintであるディクショナリの作成</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 添字として使われるデータの部分をキー</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// それに対応したデータをバリューと呼ぶ．</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 用語が衝突しているが，式の評価結果である値とは直接は関係はない．</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> dict <span class="op">=</span> <span class="kw">new</span> Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;();</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 辞書に要素を追加するには Add メソッドを用いる．</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        dict<span class="op">.</span><span class="fu">Add</span><span class="op">(</span> <span class="st">&quot;Chocolate&quot;</span><span class="op">,</span> <span class="dv">2</span> <span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        dict<span class="op">.</span><span class="fu">Add</span><span class="op">(</span> <span class="st">&quot;Chips&quot;</span><span class="op">,</span>     <span class="dv">4</span> <span class="op">);</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        dict<span class="op">.</span><span class="fu">Add</span><span class="op">(</span> <span class="st">&quot;Candy&quot;</span><span class="op">,</span>     <span class="dv">5</span> <span class="op">);</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// バリューにはキーが添字である配列のようにアクセスできる</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        dict<span class="op">[</span><span class="st">&quot;Chips&quot;</span><span class="op">]</span> <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> <span class="st">&quot;dict[</span><span class="sc">\&quot;</span><span class="st">Chips</span><span class="sc">\&quot;</span><span class="st">] = &quot;</span> <span class="op">+</span> dict<span class="op">[</span><span class="st">&quot;Chips&quot;</span><span class="op">]</span> <span class="op">);</span> <span class="co">// dict[&quot;Chips&quot;] = 7</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ContainsKey メソッドにより，キーを含んでいるか否かを検査できる．</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> dict<span class="op">.</span><span class="fu">ContainsKey</span><span class="op">(</span><span class="st">&quot;Candy&quot;</span><span class="op">)</span> <span class="op">);</span>  <span class="co">// True</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> dict<span class="op">.</span><span class="fu">ContainsKey</span><span class="op">(</span><span class="st">&quot;Banana&quot;</span><span class="op">)</span> <span class="op">);</span> <span class="co">// False </span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">// foreach 文では個々の要素は KeyValuePair&lt;string, int&gt; として手に入る</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span> KeyValuePair<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> kv <span class="kw">in</span> dict <span class="op">)</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> kv<span class="op">.</span><span class="fu">Key</span> <span class="op">+</span> <span class="st">&quot; -&gt; &quot;</span> <span class="op">+</span> kv<span class="op">.</span><span class="fu">Value</span> <span class="op">);</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">// キーのみが必要な場合は Keys プロパティを使う．</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">// もちろん，キーからバリューを引けるので バリューにもアクセスできる．</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// なお dict.Keys は Dictionary&lt;string, int&gt;.KeyCollection 型</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span> <span class="dt">string</span> k <span class="kw">in</span> dict<span class="op">.</span><span class="fu">Keys</span> <span class="op">)</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> k <span class="op">+</span> <span class="st">&quot; -&gt; &quot;</span> <span class="op">+</span> dict<span class="op">[</span>k<span class="op">]</span> <span class="op">);</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">// バリューのみが必要な場合は Values プロパティを使う．</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span> <span class="dt">int</span> v <span class="kw">in</span> dict<span class="op">.</span><span class="fu">Values</span> <span class="op">)</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> <span class="st">&quot;Value: &quot;</span> <span class="op">+</span> v <span class="op">);</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 新しいキーは添字アクセスでも追加できる</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        dict<span class="op">[</span><span class="st">&quot;Banana&quot;</span><span class="op">]</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">// キーを指定することで，そのキーと関連づけられているバリューの組を辞書から取り除ける．</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        dict<span class="op">.</span><span class="fu">Remove</span><span class="op">(</span><span class="st">&quot;Candy&quot;</span><span class="op">);</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span> <span class="dt">var</span> kv <span class="kw">in</span> dict <span class="op">)</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> kv<span class="op">.</span><span class="fu">Key</span> <span class="op">+</span> <span class="st">&quot; -&gt; &quot;</span> <span class="op">+</span> kv<span class="op">.</span><span class="fu">Value</span> <span class="op">);</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上のプログラムの出力は以下となる．</p>
<pre class="text"><code>dict[&quot;Chips&quot;] = 7

True
False

Chocolate -&gt; 2
Chips -&gt; 7
Candy -&gt; 5

Chocolate -&gt; 2
Chips -&gt; 7
Candy -&gt; 5

Value: 2
Value: 7
Value: 5

Chocolate -&gt; 2
Chips -&gt; 7
Banana -&gt; 2</code></pre>
<section id="上記のコードで使用したdictionarytkeytvalueのコンストラクタプロパティメソッド" class="level4">
<h4>上記のコードで使用した<code>Dictionary&lt;TKey,TValue&gt;</code>のコンストラクタ，プロパティ，メソッド</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">名前</th>
<th style="text-align: left;">説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Dictionary&lt;TKey,TValue&gt;()</code></td>
<td style="text-align: left;">キーが<code>TKey</code>，バリューが<code>TValue</code>型であるようなディクショナリを作成するコンストラクタ．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Add(TKey, TValue)</code></td>
<td style="text-align: left;">キーとバリューの対応を付けを辞書に追加する．キーが辞書にすでに存在していたら例外（後述）発生．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>this[TKey]</code></td>
<td style="text-align: left;">インデクサー．<code>dict[k] = v</code>は<code>k</code>が辞書に存在しない場合は<code>dict.Add(k,v)</code>と同様．存在する場合はバリューを<code>v</code>で上書き．<code>dict[k]</code>を式として使うときはキーが辞書に存在してなければ例外発生．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ContainsKey(TKey)</code></td>
<td style="text-align: left;">キーが辞書に含まれているか否かを判定する．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Keys</code></td>
<td style="text-align: left;">キーのコレクションを表すプロパティ．読み出し専用．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Values</code></td>
<td style="text-align: left;">バリューのコレクションを表すプロパティ．読み出し専用．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Remove(TKey)</code></td>
<td style="text-align: left;">指定されたキーと対応するバリューを取り除く．返り値はキーの有無（取り除けたか否か）を表す<code>bool</code></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="オブジェクト初期化子object-initializer" class="level2">
<h2>オブジェクト初期化子（object initializer）</h2>
<p>ディクショナリは<strong>オブジェクト初期化子</strong>やコレクション初期化子（<a href="./w3.html">前回参照</a>）を用いることで下記のように初期値を指定することができる．</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> DictionaryExample2</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">()</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// オブジェクト初期化子を利用した版</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> dict <span class="op">=</span> <span class="kw">new</span> Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;()</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">// この{}で囲まれている部分がオブジェクト初期化子（{}を含む）</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">[</span><span class="st">&quot;Chocolate&quot;</span><span class="op">]</span> <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="co">// 注意 &quot;;&quot; でなく &quot;,&quot;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">[</span><span class="st">&quot;Chips&quot;</span><span class="op">]</span>     <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">[</span><span class="st">&quot;Candy&quot;</span><span class="op">]</span>     <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span> KeyValuePair<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> kv <span class="kw">in</span> dict <span class="op">)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> kv<span class="op">.</span><span class="fu">Key</span> <span class="op">+</span> <span class="st">&quot; -&gt; &quot;</span> <span class="op">+</span> kv<span class="op">.</span><span class="fu">Value</span> <span class="op">);</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">// コレクション初期化子を利用した版 </span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> dict2 <span class="op">=</span> <span class="kw">new</span> Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;()</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 以下の括弧内がAddの引数になる</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span> <span class="st">&quot;Chocolate&quot;</span><span class="op">,</span> <span class="dv">2</span> <span class="op">},</span> </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span> <span class="st">&quot;Chips&quot;</span><span class="op">,</span>     <span class="dv">4</span> <span class="op">},</span> </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span> <span class="st">&quot;Candy&quot;</span><span class="op">,</span>     <span class="dv">5</span> <span class="op">}</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span> KeyValuePair<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> kv <span class="kw">in</span> dict2 <span class="op">)</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> kv<span class="op">.</span><span class="fu">Key</span> <span class="op">+</span> <span class="st">&quot; -&gt; &quot;</span> <span class="op">+</span> kv<span class="op">.</span><span class="fu">Value</span> <span class="op">);</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>オブジェクト初期化子は上記の <code>new Dictionary&lt;string, int&gt;()</code>の直後の中括弧の部分である．一般に，C#ではオブジェクト生成直後のpublicフィールドやプロパティ，添字への代入を，オブジェクト初期化子を使うことで生成とまとめて行うことができる．</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Point <span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">double</span> X<span class="op">;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">double</span> Y<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ObjectInitializerExample</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">()</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// オブジェクト初期化子により，XとYに生成後に代入する．</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 実際に以下は</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">//    Point temp = new Point();</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">//    temp.X = 2;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">//    temp.Y = 3;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">//    Point p = temp;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// のように挙動する．</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        Point p <span class="op">=</span> <span class="kw">new</span> <span class="fu">Point</span><span class="op">()</span> <span class="op">{</span> X <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> Y <span class="op">=</span> <span class="dv">3</span> <span class="op">};</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> <span class="st">&quot;(&quot;</span> <span class="op">+</span> p<span class="op">.</span><span class="fu">X</span> <span class="op">+</span> <span class="st">&quot;, &quot;</span> <span class="op">+</span> p<span class="op">.</span><span class="fu">Y</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span> <span class="op">);</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="例外とその捕捉" class="level2">
<h2>例外とその捕捉</h2>
<p>さて，以下のコードはどのように振る舞うだろうか？</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExceptionExample</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">()</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 空のディクショナリの作成</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> dict <span class="op">=</span> <span class="kw">new</span> Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;();</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 存在しないキーへのアクセス</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> dict<span class="op">[</span><span class="st">&quot;somekey&quot;</span><span class="op">]</span> <span class="op">);</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>実際に実行させてみると，以下のような実行時エラーとなる.</p>
<pre class="text"><code>Unhandled exception. System.Collections.Generic.KeyNotFoundException: The given key 'somekey' was not present in the dictionary.
    at System.Collections.Generic.Dictionary`2.get_Item(TKey key)
    at ExceptionExample.Main() in /Users/kztk/prog/cs/Materials/Week4/ExceptionExample/Program.cs:line 12</code></pre>
<p>もちろん，このようなエラーは<code>ContainsKey(TKey)</code>メソッド等を使って逐一検査すれば防ぐことができる．しかしながら，そうした逐一の検査は<em>煩雑でありなおかつコードの見通しを悪く</em>する．また，問題が起きてしまった場合の処理も共通であることもしばしばである．たとえば，対話的アプリケーションだとエラーを報告しユーザの入力を再度促すことになるだろうし，対話的でないアプリケーションだとユーザフレンドリーなエラーメッセージを吐いて終了することになるだろう．</p>
<p>そのような問題を解決するのが<strong>例外処理</strong>である．例外は上記の存在しないキーへのアクセスなど様々な原因で投げられる．
<code>try</code>-<code>catch</code>文を用いると例外を捕捉することができる．</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExceptionExample2</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">()</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 空のディクショナリの作成</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;</span> dict <span class="op">=</span> <span class="kw">new</span> Dictionary<span class="op">&lt;</span><span class="dt">string</span><span class="op">,</span> <span class="dt">int</span><span class="op">&gt;();</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">try</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;Hi&quot;</span><span class="op">);</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> dict<span class="op">[</span><span class="st">&quot;somekey&quot;</span><span class="op">]</span> <span class="op">);</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;Hello&quot;</span><span class="op">);</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> dict<span class="op">[</span><span class="st">&quot;anotherkey&quot;</span><span class="op">]</span> <span class="op">);</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;Hello?&quot;</span><span class="op">);</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> dict<span class="op">[</span><span class="st">&quot;yetanotherkey&quot;</span><span class="op">]</span> <span class="op">);</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;Hello??&quot;</span><span class="op">);</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">catch</span> <span class="op">(</span>KeyNotFoundException e<span class="op">)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            <span class="co">// tryの中で KeyNotFoundException型（あるいはその派生型）の例外が発生したら，以下の処理を実施．</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;Caught exception:&quot;</span><span class="op">);</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>e<span class="op">);</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;---------------------------&quot;</span><span class="op">);</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;e.GetType().Name: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">GetType</span><span class="op">().</span><span class="fu">Name</span> <span class="op">);</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;e.Message: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">Message</span> <span class="op">);</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;e.Source: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">Source</span> <span class="op">);</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;e.TargetSite: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">TargetSite</span> <span class="op">);</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;e.StackTrace:&quot;</span><span class="op">);</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> e<span class="op">.</span><span class="fu">StackTrace</span> <span class="op">);</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 例外が発生し捕捉された or 発生しなかったならばここに処理が移る．</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;Hello, again.&quot;</span><span class="op">);</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上記プログラムを実行すると以下の出力が得られる．</p>
<pre class="text"><code>Hi
Caught exception:
System.Collections.Generic.KeyNotFoundException: The given key 'somekey' was not present in the dictionary.
    at System.Collections.Generic.Dictionary`2.get_Item(TKey key)
    at ExceptionExample2.Main() in /Users/kztk/prog/cs/Materials/Week4/ExceptionExample2/Program.cs:line 14
---------------------------

e.GetType().Name: KeyNotFoundException
e.Message: The given key 'somekey' was not present in the dictionary.
e.Source: System.Private.CoreLib
e.TargetSite: Void ThrowKeyNotFoundException[T](T)
e.StackTrace:
    at System.Collections.Generic.Dictionary`2.get_Item(TKey key)
    at ExceptionExample2.Main() in /Users/kztk/prog/cs/Materials/Week4/ExceptionExample2/Program.cs:line 14
Hello, again.</code></pre>
<p>例外を投げるには<code>throw</code>文を使用する．</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Student</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">int</span> score <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> Score <span class="op">{</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">get</span> <span class="op">{</span> <span class="kw">return</span> score<span class="op">;</span>  <span class="op">}</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">set</span> <span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span><span class="dv">0</span> <span class="op">&lt;=</span> value <span class="op">&amp;&amp;</span> value <span class="op">&lt;=</span> <span class="dv">100</span><span class="op">)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                score <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 例外を投げる．</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">ArgumentException</span><span class="op">(</span><span class="st">&quot;Scoreは0から100までの範囲内の整数でなければならない&quot;</span><span class="op">);</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">string</span> Name <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="kw">set</span><span class="op">;</span> <span class="op">}</span> <span class="op">=</span> <span class="st">&quot;&quot;</span><span class="op">;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ExceptionExample3</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">()</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">try</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            Student s <span class="op">=</span> <span class="kw">new</span> <span class="fu">Student</span> <span class="op">()</span> <span class="op">{</span> Name <span class="op">=</span> <span class="st">&quot;Taro Tohoku&quot;</span><span class="op">,</span> Score <span class="op">=</span> <span class="dv">105</span> <span class="op">}</span> <span class="op">;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        <span class="kw">catch</span><span class="op">(</span>ArgumentException e<span class="op">)</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>e<span class="op">);</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上記のコードの実行結果は以下となる．</p>
<pre class="text"><code>System.ArgumentException: Scoreは0から100までの範囲内の整数でなければならない
    at Student.set_Score(Int32 value) in /Users/kztk/prog/cs/Materials/Week4/ExceptionExample3/Program.cs:line 16
    at ExceptionExample3.Main() in /Users/kztk/prog/cs/Materials/Week4/ExceptionExample3/Program.cs:line 29</code></pre>
<p>一般的には例外とは，<code>System.Exception</code>を継承しているクラスのオブジェクトである．そのため，<code>System.Exception</code>かその派生クラス（上記<code>ArgumentException</code>や<code>KeyNotFoundException</code>など）を継承することでユーザ定義の例外を作成することもできる．</p>
<p>また，一つの<code>try</code>はいくつもの<code>catch</code>ブロックを持つことができる．</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">try</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// s や dict が適当に（nullでないオブジェクトとして）定義されているとする</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    s<span class="op">.</span><span class="fu">Score</span> <span class="op">=</span> dict<span class="op">[</span>s<span class="op">.</span><span class="fu">Name</span><span class="op">];</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>s<span class="op">.</span><span class="fu">Score</span><span class="op">);</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span><span class="op">(</span>ArgumentNullException e<span class="op">)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// この具体例においては，s.Name がnullの場合に発生</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// なお，ArgumentNullException は ArgumentException の派生クラス</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ArgumentNullException が起きたときの処理</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> <span class="op">(</span>KeyNotFoundException e<span class="op">)</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// この具体例においては，dictがキーs.Nameを含んでいないときに発生</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// なお，KeyNotFoundException は Exception の（直接ではないが）派生クラス</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// KeyNotFoundException が起きたときの処理</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span><span class="op">(</span>ArgumentException e<span class="op">)</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// この具体例においては，dict[s.Name] が0〜100の範囲にないときに発生</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// なお，ArgumentException は Exception の（直接ではないが）派生クラス</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ArgumentException が起きたときの処理</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span><span class="op">(</span>Exception e<span class="op">)</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// この具体例では一見発生しなさそうに見えるが，WriteLine がIOExceptionを投げる可能性がある．</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 私は未確認だが，標準出力が/dev/fullにリダイレクトされている場合？</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">// （参考： &lt;https://blog.sunfishcode.online/bugs-in-hello-world/&gt; ）</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Exceptionが起きたときの処理</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>このとき，より特定（より派生側の）の例外に対する<code>catch</code>をより先頭に書く．そうでない場合はC#ではコンパイルエラーとなる．もし，そのような場合が許されたならば，最初の<code>catch</code>で例外が捕捉されてしまうので，後段のcatchが使われなくなる．</p>
</section>
<section id="ファイル入出力" class="level2">
<h2>ファイル入出力</h2>
<p>ここではテキストファイルについてのみ紹介する．</p>
<div class="important">
<div class="title">
<p>Important</p>
</div>
<p>以下において<code>MyText.txt</code>は<em>.csprojファイルと同じフォルダ（プロジェクトルート）直下</em>に置くことを想定している．
Visual Studioを使っている方は設定が必要になる．</p>
<p>プログラム中の相対パス（<code>./MyText.txt</code>等）の基準は<strong>作業フォルダ（作業ディレクトリ）</strong>である．作業フォルダは<a href="./setup.html">環境設定1</a>で紹介した方法でプロジェクトを作成し・プログラムを実行しているのならば，VS Codeで開いたフォルダ（プロジェクトルート，つまり.csprojファイルがあるフォルダ）が作業フォルダになるはずだ．なので，相対パス<code>./MyText.txt</code>はVS Codeで開いたフォルダ直下に置かれた<code>MyText.txt</code>を指す．</p>
<p>作業フォルダがどこなのかを確認するには，staticプロパティである</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Environment<span class="op">.</span><span class="fu">CurrentDirectory</span></span></code></pre></div>
<p>の値を調べればよい．</p>
<p>なお，もう少し正確に言えばコマンドラインから<code>dotnet run</code>を実行する場合は，プロジェクトルートでなくそのコマンドを実行したフォルダが作業フォルダになる．</p>
<p>Visual Studioを利用している場合は特に何も設定しなければ実行ファイルがあるフォルダが作業フォルダとなる．これはさすがに不便だと思うので，必要に応じて.csprojの<code>&lt;PropertyGroup&gt;...&lt;/PropertyGroup&gt;</code>内に以下の行を追加することで作業フォルダを.csprojファイルのあるフォルダとするのがよいだろう．</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">StartWorkingDirectory</span>&gt;$(MSBuildProjectDirectory)&lt;/<span class="kw">StartWorkingDirectory</span>&gt;</span></code></pre></div>
<p>Visual Studioで.csprojファイルを編集するには「ソリューションエクスプローラー」/「ソリューション」で当該プロジェクト名を右クリックし「プロジェクト ファイルの編集」を選ぶ．</p>
</div>
<section id="ファイルからの入力" class="level3">
<h3>ファイルからの入力</h3>
<p><code>System.IO.File</code>のstaticメソッド<code>ReadAllText</code>や<code>ReadAllLines</code>を利用したり，<code>OpenText</code>して得られる<code>System.IO.StreamReader</code>オブジェクトを利用したりする方法がある（他にもある）．</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">IO</span><span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FileInputExample</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">()</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// いろんな方法でファイルの中身を標準出力に出力する．</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> fileToOpen <span class="op">=</span> <span class="st">&quot;./MyText.txt&quot;</span><span class="op">;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">try</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ファイルの内容を一気に，一個のstringとして読みとる．</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ファイルが小さい，またはどうせ一度は全部読む必要があるのなら．</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">string</span> txt <span class="op">=</span> File<span class="op">.</span><span class="fu">ReadAllText</span><span class="op">(</span>fileToOpen<span class="op">);</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;一気に全部読む（結果を文字列に）&quot;</span><span class="op">);</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>txt<span class="op">);</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;一気に全部読む（結果を文字列の配列に）&quot;</span><span class="op">);</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ファイルの内容を一気に，各行のstringの配列として読みとる（各行の終端の改行文字は含まれない）</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ファイルが小さい，またはどうせ一度は全部読む必要があるのなら．</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">string</span><span class="op">[]</span> lines <span class="op">=</span> File<span class="op">.</span><span class="fu">ReadAllLines</span><span class="op">(</span>fileToOpen<span class="op">);</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>            <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> s <span class="kw">in</span> lines<span class="op">)</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 読みこんだ行を表示する．</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>                Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>s<span class="op">);</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;一行ごと処理&quot;</span><span class="op">);</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>            <span class="co">// （utf-8の）テキストファイルを開く</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>            StreamReader sr <span class="op">=</span> File<span class="op">.</span><span class="fu">OpenText</span><span class="op">(</span>fileToOpen<span class="op">);</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">try</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>                <span class="co">// ファイルの中身を一行ずつ処理する．ファイルが大きいときなどメモリ使用量を気にするとき．</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>                <span class="dt">string</span><span class="op">?</span> s<span class="op">;</span> <span class="co">// string?はstringのnull許容版．sr.ReadLine()の返り値の型はstring? </span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>                <span class="kw">while</span> <span class="op">((</span>s <span class="op">=</span> sr<span class="op">.</span><span class="fu">ReadLine</span><span class="op">())</span> <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>                    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>s<span class="op">);</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">finally</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>                <span class="co">// finallyブロックは例外が発生した場合もしない場合も実行される</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 開いたファイルを閉じる．srがGCされる際にも閉じられるが，</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>                <span class="co">// 同時に開けるファイルの数は有限なので，不要になったらすぐに閉じるのがよい</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>                sr<span class="op">.</span><span class="fu">Dispose</span><span class="op">();</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;一行ごと処理（usingを使用）&quot;</span><span class="op">);</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>            <span class="co">// using文を使うともっと簡潔に書ける</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>            <span class="kw">using</span> <span class="op">(</span>StreamReader sr2 <span class="op">=</span> File<span class="op">.</span><span class="fu">OpenText</span><span class="op">(</span>fileToOpen<span class="op">))</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>                <span class="co">// この中で例外が発生した場合もそうでない場合も sr2.Dispose() が呼ばれる</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>                <span class="kw">while</span> <span class="op">(</span>sr2<span class="op">.</span><span class="fu">Peek</span><span class="op">()</span> <span class="op">&gt;</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="co">// Peek を使ったほうが上に比べてトリッキーでないかも</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>                    Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>sr2<span class="op">.</span><span class="fu">ReadLine</span><span class="op">());</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>        <span class="kw">catch</span> <span class="op">(</span>FileNotFoundException e<span class="op">)</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>            <span class="co">// FileNotFoundExceptionのオブジェクトの FileName プロパティは見付からなかったファイル名を保持</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>            <span class="co">// https://docs.microsoft.com/en-us/dotnet/api/system.io.filenotfoundexception?view=net-6.0</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>            <span class="co">// 日本語版 https://docs.microsoft.com/ja-jp/dotnet/api/system.io.filenotfoundexception?view=net-6.0</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;ファイル '&quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">FileName</span> <span class="op">+</span> <span class="st">&quot;'が見付かりません&quot;</span><span class="op">);</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 他の例外は捕捉しない</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>MyText.txt の中身</p>
<pre class="text"><code>りんご
オレンジ
バナナ
みかん</code></pre>
<p>出力結果</p>
<pre class="text"><code>一気に全部読む（結果を文字列に）
りんご
オレンジ
バナナ
みかん
一気に全部読む（結果を文字列の配列に）
りんご
オレンジ
バナナ
みかん
一行ごと処理
りんご
オレンジ
バナナ
みかん
一行ごと処理（usingを使用）
りんご
オレンジ
バナナ
みかん</code></pre>
<section id="上で使用したメソッドなど" class="level4">
<h4>上で使用したメソッドなど</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">名前</th>
<th style="text-align: left;">説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>File.ReadAllText(string)</code></td>
<td style="text-align: left;">static メソッド．与えられたパスのファイルを開いて読んで閉じ，中身をstringとして返す．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>File.ReadAllLines(string)</code></td>
<td style="text-align: left;">static メソッド．与えられたパスのファイルを開いて読んで閉じ，中身を各行毎のstringの配列として返す．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>File.OpenText(string)</code></td>
<td style="text-align: left;">static メソッド．与えられたパスのファイルを開き，そこから読みだすための<code>StreamReader</code>オブジェクトを返す</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>StreamReader.ReadLine()</code></td>
<td style="text-align: left;">ストリームから一行読み，その文字列を返す．ファイルの末尾なら <code>null</code> を返す．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>StreamReader.Peek()</code></td>
<td style="text-align: left;">ストリームから次に読める文字（<code>char</code>の意味で）を表す整数（<code>int</code>）を返す．ファイルの末尾なら <code>-1</code>を返す．</td>
</tr>
</tbody>
</table>
<div class="note">
<div class="title">
<p>Note</p>
</div>
<p>上記の「パス」は絶対パスでも相対パスでもよい．相対パスは現在の作業ディレクトリ基準．設定 or 取得するには<code>Environment.CurrentDirectory</code>プロパティを用いる．</p>
</div>
</section>
</section>
<section id="using文" class="level3">
<h3>using文</h3>
<p>C#はGC付きの言語であり，参照されないオブジェクトはいずれ解放される．しかしながら，プログラミングにおいてはメモリ以外にもさまざまなリソースを使用する必要がある場合がある．ファイナライザを利用しGC時にオブジェクトが保有しているリソースを解放することはできるものの，リソースは有限であるため使用後すぐに解放することが望ましい．開いたファイル——に関連付けられたファイル記述子——はそのようなリソースの一つである．</p>
<p>リソースを確保（たとえばファイルを開く）した後の処理中に例外が発生する可能性があり，その場合にもリソースは解放（たとえばファイルを閉じる）されなければならない．その目的に<code>try</code>-<code>finally</code>を利用することもできるが，簡潔なのは<strong>using文</strong>（usingディレクティブとは違う）を使う方法である．</p>
<p>基本的な構文は大雑把には以下の通りである．</p>
<pre style="line-height:1.3">
<span class="kw">using</span> (<span class="metaname">型</span> <span class="metaname">変数</span> = <span class="metaname">リソースを確保する式</span> )
<span class="metaname">文</span>
</pre>
<p>usingブロック内で例外が発生した場合にもそうでない場合にも導入された変数に対し <code>Dispose()</code> が呼ばれリソースが解放される．</p>
<div class="note">
<div class="title">
<p>Note</p>
</div>
<p>そのため，導入された変数の型は<strong>インタフェース</strong> <code>System.IDisposable</code> を実装してなければならない．</p>
</div>
</section>
<section id="ファイルへの出力" class="level3">
<h3>ファイルへの出力</h3>
<p><code>System.IO.File</code>のstaticメソッド<code>WriteAllText</code>や<code>WriteAllLines</code>を利用したり，<code>CreateText</code>して得られる<code>System.IO.StreamWriter</code>オブジェクトを利用したりする方法がある（他にもある）．</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">IO</span><span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FileOutputExample</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">()</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span><span class="op">[]</span> txts <span class="op">=</span> <span class="op">{</span> <span class="st">&quot;りんご&quot;</span><span class="op">,</span> <span class="st">&quot;オレンジ&quot;</span><span class="op">,</span> <span class="st">&quot;バナナ&quot;</span><span class="op">,</span> <span class="st">&quot;みかん&quot;</span> <span class="op">};</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// txtはtxtsの各要素を&quot;\n&quot;を間に挟んでつなげた文字列</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// つまり，txt = txts[0] + &quot;\n&quot; + txts[1] + &quot;\n&quot; + ... + &quot;\n&quot; + txts[txts.Length - 1]</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> txt <span class="op">=</span> <span class="dt">string</span><span class="op">.</span><span class="fu">Join</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> txts<span class="op">);</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 文字列の内容を一気に書く</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        File<span class="op">.</span><span class="fu">WriteAllText</span><span class="op">(</span><span class="st">&quot;./MyText1.txt&quot;</span><span class="op">,</span> txt<span class="op">);</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 文字列配列の内容を一気に書く</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        File<span class="op">.</span><span class="fu">WriteAllLines</span><span class="op">(</span><span class="st">&quot;./MyText2.txt&quot;</span><span class="op">,</span> txts<span class="op">);</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 一行ずつ書く</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">using</span> <span class="op">(</span>StreamWriter sw <span class="op">=</span> File<span class="op">.</span><span class="fu">CreateText</span><span class="op">(</span><span class="st">&quot;./MyText3.txt&quot;</span><span class="op">))</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>            <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> s <span class="kw">in</span> txts<span class="op">)</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                sw<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span>s<span class="op">);</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上記プログラムを実行すると，実行したディレクトリにMyText1.txt，MyText2.txt および MyText3.txt というファイルが作成される．いずれも以下のような内容だが，MyText1.txt は最終行に終端の改行がない．</p>
<pre class="text"><code>りんご
オレンジ
バナナ
みかん</code></pre>
<section id="上で使用したメソッドなど-1" class="level4">
<h4>上で使用したメソッドなど</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">名前</th>
<th style="text-align: left;">説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>File.WriteAllText(string,string)</code></td>
<td style="text-align: left;">static メソッド．与えられたパスのファイルを開いて，与えられた文字列で上書きして閉じる．パスにファイルが存在してなければ作成する．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>File.WriteAllLines(string,string[])</code></td>
<td style="text-align: left;">static メソッド．与えられたパスのファイルを開いて，各行の中身が与えられた文字列の配列になるように上書きして閉じる．パスにファイルが存在してなければ作成する．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>File.CreateText(string)</code></td>
<td style="text-align: left;">static メソッド．与えられたパスのファイルを上書きモードで開き，そこへ書きこむための<code>StreamWriter</code>オブジェクトを返す．パスにファイルが存在してなければ作成する．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>StreamWriter.WriteLine(string)</code></td>
<td style="text-align: left;">ストリームへ与えられた文字列を出力する．</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="いくつかの文字列操作関数" class="level2">
<h2>いくつかの文字列操作関数</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> System<span class="op">.</span><span class="fu">Collections</span><span class="op">.</span><span class="fu">Generic</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StringExample</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Main</span><span class="op">(</span><span class="dt">string</span><span class="op">[]</span> args<span class="op">)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span><span class="op">[]</span> fruits <span class="op">=</span> <span class="op">{</span> <span class="st">&quot;apple&quot;</span><span class="op">,</span> <span class="st">&quot;orange&quot;</span><span class="op">,</span> <span class="st">&quot;banana&quot;</span> <span class="op">};</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Join(string s, string[] ss)で配列ssに含まれる各文字列を指定された区切りsで結合できる</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> joined <span class="op">=</span> <span class="dt">string</span><span class="op">.</span><span class="fu">Join</span><span class="op">(</span><span class="st">&quot;|&quot;</span><span class="op">,</span> fruits <span class="op">);</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> joined <span class="op">);</span> <span class="co">// apple|orange|banana</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Split(char c)を使うと指定の区切り文字cで文字列を分割できる</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span><span class="op">[]</span> separated <span class="op">=</span> joined<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="ch">'|'</span><span class="op">);</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> joined <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">.Split('|'): &quot;</span><span class="op">);</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showSplit</span><span class="op">(</span> separated <span class="op">);</span> </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Splitはオーバロードされていて，区切りに使うのは文字列でもよい</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">string</span> toSplit <span class="op">=</span> <span class="st">&quot;a--b--  c --d-----e--  --f&quot;</span><span class="op">;</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> toSplit <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">.Split(</span><span class="sc">\&quot;</span><span class="st">--</span><span class="sc">\&quot;</span><span class="st">)&quot;</span> <span class="op">);</span> </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showSplit</span><span class="op">(</span> toSplit<span class="op">.</span><span class="fu">Split</span><span class="op">(</span><span class="st">&quot;--&quot;</span><span class="op">)</span> <span class="op">);</span> </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Split() と引数なしで呼び出せば空白（改行や全角スペース含む）で区切る</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;Split()の例&quot;</span><span class="op">);</span> </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">showSplit</span><span class="op">(</span> <span class="st">&quot;Hello, World.  こんにちは世界</span><span class="sc">\t</span><span class="st">全角スペース→　←全角スペース</span><span class="sc">\n</span><span class="st">二行目（</span><span class="sc">\\</span><span class="st">r</span><span class="sc">\\</span><span class="st">n終端）</span><span class="sc">\r\n</span><span class="st">三行目（</span><span class="sc">\\</span><span class="st">r終端）</span><span class="sc">\r</span><span class="st">四行目&quot;</span><span class="op">.</span><span class="fu">Split</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// StartsWith(string s)で指定された文字列sで始まっているか判定できる        </span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">おはようございます</span><span class="sc">\&quot;</span><span class="st">.StartsWith(</span><span class="sc">\&quot;</span><span class="st">おはよう</span><span class="sc">\&quot;</span><span class="st">) = &quot;</span> <span class="op">+</span> <span class="st">&quot;おはようございます&quot;</span><span class="op">.</span><span class="fu">StartsWith</span><span class="op">(</span><span class="st">&quot;おはよう&quot;</span><span class="op">)</span> <span class="op">);</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">おはようございます</span><span class="sc">\&quot;</span><span class="st">.StartsWith(</span><span class="sc">\&quot;</span><span class="st">ございます</span><span class="sc">\&quot;</span><span class="st">) = &quot;</span> <span class="op">+</span> <span class="st">&quot;おはようございます&quot;</span><span class="op">.</span><span class="fu">StartsWith</span><span class="op">(</span><span class="st">&quot;ございます&quot;</span><span class="op">)</span> <span class="op">);</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">);</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// IndexOf(string s)で指定された文字列sの最初に出現する位置を取得できる（含まれていない場合は -1）</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">eieio-eieio</span><span class="sc">\&quot;</span><span class="st">.IndexOf(</span><span class="sc">\&quot;</span><span class="st">ie</span><span class="sc">\&quot;</span><span class="st">) = &quot;</span> <span class="op">+</span> <span class="st">&quot;eieio-eieio&quot;</span><span class="op">.</span><span class="fu">IndexOf</span><span class="op">(</span><span class="st">&quot;ie&quot;</span><span class="op">)</span> <span class="op">);</span> <span class="co">// &quot;eieio-eieio&quot;.IndexOf(&quot;ie&quot;) = 1</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">eieio-eieio</span><span class="sc">\&quot;</span><span class="st">.IndexOf(</span><span class="sc">\&quot;</span><span class="st">ff</span><span class="sc">\&quot;</span><span class="st">) = &quot;</span> <span class="op">+</span> <span class="st">&quot;eieio-eieio&quot;</span><span class="op">.</span><span class="fu">IndexOf</span><span class="op">(</span><span class="st">&quot;ff&quot;</span><span class="op">)</span> <span class="op">);</span> <span class="co">// &quot;eieio-eieio&quot;.IndexOf(&quot;ff&quot;) = -1</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Substring(int index) で指定された位置以降の文字列を切り出す</span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> <span class="st">&quot;abcdefghijk&quot;</span><span class="op">.</span><span class="fu">Substring</span><span class="op">(</span><span class="dv">2</span><span class="op">)</span> <span class="op">);</span> <span class="co">// cdefghijk</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Substring(int index, int length)で指定された位置からlengthだけ文字列を切り出す</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> <span class="st">&quot;abcdefghijk&quot;</span><span class="op">.</span><span class="fu">Substring</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">4</span><span class="op">)</span> <span class="op">);</span> <span class="co">// cdef</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>        <span class="kw">try</span> </span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>            <span class="co">// index + length が元の文字列の長さを超えたら  ArgumentOutOfRangeException が発生</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> <span class="st">&quot;abcdefghijk&quot;</span><span class="op">.</span><span class="fu">Substring</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">400</span><span class="op">)</span> <span class="op">);</span>             </span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>        <span class="kw">catch</span> <span class="op">(</span>ArgumentOutOfRangeException e<span class="op">)</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;例外発生: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">GetType</span><span class="op">().</span><span class="fu">Name</span> <span class="op">+</span> <span class="st">&quot;: &quot;</span> <span class="op">+</span> e<span class="op">.</span><span class="fu">Message</span> <span class="op">);</span> </span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;&quot;</span><span class="op">);</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Trim() で先頭および終端からの連続した空白を削除</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot; Hello, World.  &quot;</span><span class="op">.</span><span class="fu">Trim</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">);</span> <span class="co">// &quot;Hello, World.&quot;</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 空白は違う種類の文字でもよい（unicodeの空白文字ならよく全角空白でもOK）</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 参考：unicodeの空白文字 https://www.compart.com/en/unicode/category/Zs</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> <span class="st">&quot;　</span><span class="sc">\t</span><span class="st">Hello, World. </span><span class="sc">\r\n</span><span class="st"> &quot;</span><span class="op">.</span><span class="fu">Trim</span><span class="op">()</span> <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">);</span> <span class="co">// &quot;Hello, World.&quot;</span></span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">//                         ↑ 全角空白文字</span></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>    <span class="kw">static</span> <span class="dt">void</span> <span class="fu">showSplit</span><span class="op">(</span><span class="dt">string</span><span class="op">[]</span> ss<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">Write</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span><span class="op">);</span> <span class="co">// タブ文字</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> s <span class="kw">in</span> ss<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>            Console<span class="op">.</span><span class="fu">Write</span><span class="op">(</span><span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st">&quot;</span> <span class="op">+</span> s <span class="op">+</span> <span class="st">&quot;</span><span class="sc">\&quot;</span><span class="st"> &quot;</span><span class="op">);</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>        Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">();</span> </span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>上の実行結果</p>
<pre class="text"><code>apple|orange|banana

&quot;apple|orange|banana&quot;.Split('|'):
        &quot;apple&quot; &quot;orange&quot; &quot;banana&quot;
&quot;a--b--  c --d-----e--  --f&quot;.Split(&quot;--&quot;)
        &quot;a&quot; &quot;b&quot; &quot;  c &quot; &quot;d&quot; &quot;&quot; &quot;-e&quot; &quot;  &quot; &quot;f&quot;
Split()の例
        &quot;Hello,&quot; &quot;World.&quot; &quot;&quot; &quot;こんにちは世界&quot; &quot;全角スペース→&quot; &quot;←全角スペース&quot; &quot;二行目（\r\n終端）&quot; &quot;&quot; &quot;三行目（\r終端）&quot; &quot;四行目&quot;

&quot;おはようございます&quot;.StartsWith(&quot;おはよう&quot;) = True
&quot;おはようございます&quot;.StartsWith(&quot;ございます&quot;) = False

&quot;eieio-eieio&quot;.IndexOf(&quot;ie&quot;) = 1
&quot;eieio-eieio&quot;.IndexOf(&quot;ff&quot;) = -1

cdefghijk
cdef
例外発生: ArgumentOutOfRangeException: Index and length must refer to a location within the string. (Parameter 'length')

&quot;Hello, World.&quot;
&quot;Hello, World.&quot;</code></pre>
<section id="上で使用したstringのメソッドなど" class="level4">
<h4>上で使用した<code>string</code>のメソッドなど</h4>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">名前</th>
<th style="text-align: left;">説明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Join(string, string[])</code></td>
<td style="text-align: left;">staticメソッド．文字列の配列を与えられた区切りを中に入れて連接する．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Split(char)</code></td>
<td style="text-align: left;">文字列を与えられた区切り文字で分割した配列を返す．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Split(string)</code></td>
<td style="text-align: left;">文字列を与えられた区切り文字列で分割した配列を返す．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Split()</code></td>
<td style="text-align: left;">文字列を空白文字（改行やタブ文字や非ASCII空白も含む）で分割した配列を返す．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>StartsWith(string)</code></td>
<td style="text-align: left;">文字列が与えられた文字列で始まっているか判定する．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>IndexOf(string)</code></td>
<td style="text-align: left;">与えられた文字列が文字列中で最初に出現するインデックスを返す．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Substring(int)</code></td>
<td style="text-align: left;">与えられたインデックス以降からなる文字列を返す．</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Substring(int,int)</code></td>
<td style="text-align: left;">与えられたインデックス以降で指定された長さの文字列を返す．</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Trim()</code></td>
<td style="text-align: left;">文字列の先頭および末尾から連続した空白を取り除いた文字列を返す．</td>
</tr>
</tbody>
</table>
<div class="note">
<div class="title">
<p>Note</p>
</div>
<p><code>Substring</code>などで指定するindexや長さは<code>string</code>を<code>char</code>の配列として見たときのものである．このことは以下のように絵文字等の扱いで直感に反することがある．</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;😱&quot;</span><span class="op">.</span><span class="fu">Length</span><span class="op">);</span>              <span class="co">// 2 </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;0x{0:X}&quot;</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="st">&quot;😱&quot;</span><span class="op">[</span><span class="dv">0</span><span class="op">]);</span> <span class="co">// 0xD83D </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;0x{0:X}&quot;</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="st">&quot;😱&quot;</span><span class="op">[</span><span class="dv">1</span><span class="op">]);</span> <span class="co">// 0xDE31</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>Console<span class="op">.</span><span class="fu">WriteLine</span><span class="op">(</span><span class="st">&quot;&lt;&quot;</span> <span class="op">+</span> <span class="st">&quot;😱&quot;</span><span class="op">.</span><span class="fu">Substring</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">+</span> <span class="st">&quot;&gt;&quot;</span><span class="op">);</span> <span class="co">// &lt;�&gt;</span></span></code></pre></div>
<p>これは，charがunicodeのコードポイントを表すのに十分でないためである．charは0〜65535の範囲しか表すことができない一方，unicodeのコードポイントの最大値は 0x10FFFF = 1114111 となる．実際に絵文字等のcharの範囲で表わせないコードポイントはcharのペアとして表わされる（参考：<a href="https://datatracker.ietf.org/doc/html/rfc2781#section-2">UTF-16, an encoding of ISO 10646</a>）．</p>
<p>また，コードポイント自体も「文字」とは対応しない場合がある．たとえば，「🇯🇵」という一文字は二つのコードポイント（U+1F1EF U+1F1F5）で表現される．</p>
</div>
</section>
</section></section>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
